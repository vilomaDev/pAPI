"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3836],{7679:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var n=r(3117),a=(r(7294),r(3905));const o={title:"Destination",tags:["providers","data-transfer","experimental"]},i="Local Strapi Destination Provider",s={unversionedId:"docs/core/data-transfer/providers/local-strapi/destination",id:"docs/core/data-transfer/providers/local-strapi/destination",title:"Destination",description:"This provider will insert data into an initialized strapi instance using its Entity Service and Query Engine.",source:"@site/docs/docs/01-core/data-transfer/02-providers/04-local-strapi/02-destination.md",sourceDirName:"docs/01-core/data-transfer/02-providers/04-local-strapi",slug:"/docs/core/data-transfer/providers/local-strapi/destination",permalink:"/docs/core/data-transfer/providers/local-strapi/destination",draft:!1,editUrl:"https://github.com/strapi/strapi/tree/main/docs/docs/docs/01-core/data-transfer/02-providers/04-local-strapi/02-destination.md",tags:[{label:"providers",permalink:"/tags/providers"},{label:"data-transfer",permalink:"/tags/data-transfer"},{label:"experimental",permalink:"/tags/experimental"}],version:"current",sidebarPosition:2,frontMatter:{title:"Destination",tags:["providers","data-transfer","experimental"]},sidebar:"docs",previous:{title:"Source",permalink:"/docs/core/data-transfer/providers/local-strapi/source"},next:{title:"Overview",permalink:"/docs/core/data-transfer/providers/remote-strapi/overview"}},l={},p=[{value:"Provider Options",id:"provider-options",level:2},{value:"Restore",id:"restore",level:3},{value:"Rollbacks",id:"rollbacks",level:3}],c={toc:p};function d(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"local-strapi-destination-provider"},"Local Strapi Destination Provider"),(0,a.kt)("p",null,"This provider will insert data into an initialized ",(0,a.kt)("inlineCode",{parentName:"p"},"strapi")," instance using its Entity Service and Query Engine."),(0,a.kt)("h2",{id:"provider-options"},"Provider Options"),(0,a.kt)("p",null,"The accepted options are defined in ",(0,a.kt)("inlineCode",{parentName:"p"},"ILocalFileSourceProviderOptions"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"  getStrapi(): Strapi.Strapi | Promise<Strapi.Strapi>; // return an initialized instance of Strapi\n  autoDestroy?: boolean; // shut down the instance returned by getStrapi() at the end of the transfer\n  restore?: restore.IRestoreOptions; // the options to use when strategy is 'restore'\n  strategy: 'restore'; // conflict management strategy; only the restore strategy is available at this time\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"strategy")," defines the conflict management strategy used. Currently, only ",(0,a.kt)("inlineCode",{parentName:"p"},'"restore"')," is available as an option."),(0,a.kt)("h3",{id:"restore"},"Restore"),(0,a.kt)("p",null,'A conflict management strategy of "restore" deletes all existing Strapi data before a transfer to avoid any conflicts.'),(0,a.kt)("p",null,"The following restore options are available:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typecript"},"export interface IRestoreOptions {\n  assets?: boolean; // delete media library files before transfer\n  configuration?: {\n    webhook?: boolean; // delete webhooks before transfer\n    coreStore?: boolean; // delete core store before transfer\n  };\n  entities?: {\n    include?: string[]; // only delete these stage entities before transfer\n    exclude?: string[]; // exclude these stage entities from deletion\n    filters?: ((contentType: ContentTypeSchema) => boolean)[]; // custom filters to exclude a content type from deletion\n    params?: { [uid: string]: unknown }; // params object passed to deleteMany before transfer for custom deletions\n  };\n}\n")),(0,a.kt)("h3",{id:"rollbacks"},"Rollbacks"),(0,a.kt)("p",null,"This local Strapi destination provider automatically provides a rollback mechanism on error."),(0,a.kt)("p",null,"For Strapi data, that is done with a database transaction wrapped around the restore and the insertion of data and committing on succes and rolling back on failure."),(0,a.kt)("p",null,"For Strapi assets (ie, the media library files) this is done by attempting to temporarily move the existing assets to a backup directory to ",(0,a.kt)("inlineCode",{parentName:"p"},"uploads_backup_{timestamp}"),", and then deleting it on success, or deleting the failed import files and putting the backup back into place on failure. In some cases of failure, it may be impossible to move the backup files back into place, so you will need to manually restore the backup assets files."),(0,a.kt)("p",null,"Note: Because of the need for write access, environments without filesystem permissions to move the assets folder (common for virtual environments where /uploads is mounted as a read-only drive) will be unable to include assets in a transfer and the asset stage must be excluded in order to run the transfer."))}d.isMDXComponent=!0},3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>f});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var l=n.createContext({}),p=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},c=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(r),f=a,m=u["".concat(l,".").concat(f)]||u[f]||d[f]||o;return r?n.createElement(m,i(i({ref:t},c),{},{components:r})):n.createElement(m,i({ref:t},c))}));function f(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,i=new Array(o);i[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var p=2;p<o;p++)i[p]=r[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}u.displayName="MDXCreateElement"}}]);